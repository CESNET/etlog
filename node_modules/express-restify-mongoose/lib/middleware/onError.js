'use strict';

var serializeError = require('serialize-error');

module.exports = function (isExpress) {
  return function (err, req, res, next) {
    var serializedErr = serializeError(err);

    delete serializedErr.stack;

    if (serializedErr.errors) {
      for (var key in serializedErr.errors) {
        delete serializedErr.errors[key].reason;
        delete serializedErr.errors[key].stack;
      }
    }

    res.setHeader('Content-Type', 'application/json');

    if (isExpress) {
      res.status(req.erm.statusCode).send(serializedErr);
    } else {
      res.send(req.erm.statusCode, serializedErr);
    }
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL29uRXJyb3IuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLGlCQUFpQixRQUFRLGlCQUFSLENBQXZCOztBQUVBLE9BQU8sT0FBUCxHQUFpQixVQUFVLFNBQVYsRUFBcUI7QUFDcEMsU0FBTyxVQUFVLEdBQVYsRUFBZSxHQUFmLEVBQW9CLEdBQXBCLEVBQXlCLElBQXpCLEVBQStCO0FBQ3BDLFFBQU0sZ0JBQWdCLGVBQWUsR0FBZixDQUF0Qjs7QUFFQSxXQUFPLGNBQWMsS0FBckI7O0FBRUEsUUFBSSxjQUFjLE1BQWxCLEVBQTBCO0FBQ3hCLFdBQUssSUFBSSxHQUFULElBQWdCLGNBQWMsTUFBOUIsRUFBc0M7QUFDcEMsZUFBTyxjQUFjLE1BQWQsQ0FBcUIsR0FBckIsRUFBMEIsTUFBakM7QUFDQSxlQUFPLGNBQWMsTUFBZCxDQUFxQixHQUFyQixFQUEwQixLQUFqQztBQUNEO0FBQ0Y7O0FBRUQsUUFBSSxTQUFKLENBQWMsY0FBZCxFQUE4QixrQkFBOUI7O0FBRUEsUUFBSSxTQUFKLEVBQWU7QUFDYixVQUFJLE1BQUosQ0FBVyxJQUFJLEdBQUosQ0FBUSxVQUFuQixFQUErQixJQUEvQixDQUFvQyxhQUFwQztBQUNELEtBRkQsTUFFTztBQUNMLFVBQUksSUFBSixDQUFTLElBQUksR0FBSixDQUFRLFVBQWpCLEVBQTZCLGFBQTdCO0FBQ0Q7QUFDRixHQW5CRDtBQW9CRCxDQXJCRCIsImZpbGUiOiJvbkVycm9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2VyaWFsaXplRXJyb3IgPSByZXF1aXJlKCdzZXJpYWxpemUtZXJyb3InKVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXNFeHByZXNzKSB7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uIChlcnIsIHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICBjb25zdCBzZXJpYWxpemVkRXJyID0gc2VyaWFsaXplRXJyb3IoZXJyKVxyXG5cclxuICAgIGRlbGV0ZSBzZXJpYWxpemVkRXJyLnN0YWNrXHJcblxyXG4gICAgaWYgKHNlcmlhbGl6ZWRFcnIuZXJyb3JzKSB7XHJcbiAgICAgIGZvciAobGV0IGtleSBpbiBzZXJpYWxpemVkRXJyLmVycm9ycykge1xyXG4gICAgICAgIGRlbGV0ZSBzZXJpYWxpemVkRXJyLmVycm9yc1trZXldLnJlYXNvblxyXG4gICAgICAgIGRlbGV0ZSBzZXJpYWxpemVkRXJyLmVycm9yc1trZXldLnN0YWNrXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXHJcblxyXG4gICAgaWYgKGlzRXhwcmVzcykge1xyXG4gICAgICByZXMuc3RhdHVzKHJlcS5lcm0uc3RhdHVzQ29kZSkuc2VuZChzZXJpYWxpemVkRXJyKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzLnNlbmQocmVxLmVybS5zdGF0dXNDb2RlLCBzZXJpYWxpemVkRXJyKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
//# sourceMappingURL=onError.js.map