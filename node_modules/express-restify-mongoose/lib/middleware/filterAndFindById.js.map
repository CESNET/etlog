{"version":3,"sources":["../../src/middleware/filterAndFindById.js"],"names":[],"mappings":";;;;AAAA,IAAM,OAAO,QAAQ,MAAR,CAAb;;AAEA,OAAO,OAAP,GAAiB,UAAU,KAAV,EAAiB,OAAjB,EAA0B;AACzC,MAAM,eAAe,QAAQ,iBAAR,EAA2B,OAA3B,CAArB;;AAEA,SAAO,UAAU,GAAV,EAAe,GAAf,EAAoB,IAApB,EAA0B;AAC/B,QAAI,CAAC,IAAI,MAAJ,CAAW,EAAhB,EAAoB;AAClB,aAAO,MAAP;AACD;;AAED,YAAQ,aAAR,CAAsB,KAAtB,EAA6B,GAA7B,EAAkC,UAAC,eAAD,EAAqB;AACrD,sBAAgB,OAAhB,GAA0B,GAA1B,qBACG,QAAQ,UADX,EACwB,IAAI,MAAJ,CAAW,EADnC,GAEG,IAFH,CAEQ,KAFR,EAEe,IAFf,CAEoB,QAAQ,cAF5B,EAE4C,IAF5C,GAEmD,IAFnD,CAEwD,UAAC,GAAD,EAAS;AAC/D,YAAI,CAAC,GAAL,EAAU;AACR,iBAAO,aAAa,GAAb,EAAkB,GAAlB,EAAuB,IAAvB,EAA6B,IAAI,KAAJ,CAAU,KAAK,YAAL,CAAkB,GAAlB,CAAV,CAA7B,CAAP;AACD;;AAED,YAAI,GAAJ,CAAQ,QAAR,GAAmB,GAAnB;;AAEA;AACD,OAVD,EAUG,aAAa,GAAb,EAAkB,GAAlB,EAAuB,IAAvB,CAVH;AAWD,KAZD;AAaD,GAlBD;AAmBD,CAtBD","file":"filterAndFindById.js","sourcesContent":["const http = require('http')\r\n\r\nmodule.exports = function (model, options) {\r\n  const errorHandler = require('../errorHandler')(options)\r\n\r\n  return function (req, res, next) {\r\n    if (!req.params.id) {\r\n      return next()\r\n    }\r\n\r\n    options.contextFilter(model, req, (filteredContext) => {\r\n      filteredContext.findOne().and({\r\n        [options.idProperty]: req.params.id\r\n      }).lean(false).read(options.readPreference).exec().then((doc) => {\r\n        if (!doc) {\r\n          return errorHandler(req, res, next)(new Error(http.STATUS_CODES[404]))\r\n        }\r\n\r\n        req.erm.document = doc\r\n\r\n        next()\r\n      }, errorHandler(req, res, next))\r\n    })\r\n  }\r\n}\r\n"]}