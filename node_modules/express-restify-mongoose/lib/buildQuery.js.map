{"version":3,"sources":["../src/buildQuery.js"],"names":[],"mappings":";;AAAA,IAAM,UAAU,QAAQ,UAAR,CAAhB;;AAEA,OAAO,OAAP,GAAiB,UAAU,OAAV,EAAmB;AAClC,SAAO,UAAU,KAAV,EAAiB,YAAjB,EAA+B;AACpC,QAAM,UAAU,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AAC/C,UAAI,CAAC,YAAL,EAAmB;AACjB,eAAO,QAAQ,KAAR,CAAP;AACD;;AAED,UAAI,aAAa,KAAjB,EAAwB;AACtB,cAAM,KAAN,CAAY,aAAa,KAAzB;AACD;;AAED,UAAI,aAAa,IAAjB,EAAuB;AACrB,cAAM,IAAN,CAAW,aAAa,IAAxB;AACD;;AAED,UAAI,QAAQ,KAAR,KAAkB,CAAC,aAAa,KAAd,IAAuB,aAAa,KAAb,KAAuB,GAA9C,IAAqD,aAAa,KAAb,GAAqB,QAAQ,KAApG,CAAJ,EAAgH;AAC9G,qBAAa,KAAb,GAAqB,QAAQ,KAA7B;AACD;;AAED,UAAI,aAAa,KAAb,IAAsB,MAAM,EAAN,KAAa,OAAnC,IAA8C,CAAC,aAAa,QAAhE,EAA0E;AACxE,cAAM,KAAN,CAAY,aAAa,KAAzB;AACD;;AAED,UAAI,aAAa,IAAjB,EAAuB;AACrB,cAAM,IAAN,CAAW,aAAa,IAAxB;AACD;;AAED,UAAI,aAAa,QAAjB,EAA2B;AACzB,cAAM,QAAN,CAAe,aAAa,QAA5B;AACD;;AAED,UAAI,aAAa,MAAjB,EAAyB;AACvB,cAAM,MAAN,CAAa,aAAa,MAA1B;AACD;;AAED,UAAI,aAAa,QAAjB,EAA2B;AACzB,cAAM,QAAN,CAAe,aAAa,QAA5B;AACD;;AAED,UAAI,QAAQ,cAAZ,EAA4B;AAC1B,cAAM,IAAN,CAAW,QAAQ,cAAnB;AACD;;AAED,UAAI,QAAQ,IAAZ,EAAkB;AAChB,cAAM,IAAN,CAAW,QAAQ,IAAnB;AACD;;AAED,cAAQ,KAAR;AACD,KA9Ce,CAAhB;;AAgDA,WAAO,OAAP;AACD,GAlDD;AAmDD,CApDD","file":"buildQuery.js","sourcesContent":["const Promise = require('bluebird')\r\n\r\nmodule.exports = function (options) {\r\n  return function (query, queryOptions) {\r\n    const promise = new Promise((resolve, reject) => {\r\n      if (!queryOptions) {\r\n        return resolve(query)\r\n      }\r\n\r\n      if (queryOptions.query) {\r\n        query.where(queryOptions.query)\r\n      }\r\n\r\n      if (queryOptions.skip) {\r\n        query.skip(queryOptions.skip)\r\n      }\r\n\r\n      if (options.limit && (!queryOptions.limit || queryOptions.limit === '0' || queryOptions.limit > options.limit)) {\r\n        queryOptions.limit = options.limit\r\n      }\r\n\r\n      if (queryOptions.limit && query.op !== 'count' && !queryOptions.distinct) {\r\n        query.limit(queryOptions.limit)\r\n      }\r\n\r\n      if (queryOptions.sort) {\r\n        query.sort(queryOptions.sort)\r\n      }\r\n\r\n      if (queryOptions.populate) {\r\n        query.populate(queryOptions.populate)\r\n      }\r\n\r\n      if (queryOptions.select) {\r\n        query.select(queryOptions.select)\r\n      }\r\n\r\n      if (queryOptions.distinct) {\r\n        query.distinct(queryOptions.distinct)\r\n      }\r\n\r\n      if (options.readPreference) {\r\n        query.read(options.readPreference)\r\n      }\r\n\r\n      if (options.lean) {\r\n        query.lean(options.lean)\r\n      }\r\n\r\n      resolve(query)\r\n    })\r\n\r\n    return promise\r\n  }\r\n}\r\n"]}